---
layout: default
title: iframe跨域参数传递方式
comments: true
tags: notes
---
# iframe跨域参数传递方式

在和第三方公司进行合作的时候，经常会遇到需要进行跨域通信的情况，如下图所示，第三方公司需要获取我方的userid等信息，右下角的框内是一个我方的登录iframe窗口，在这里需要将登录后得结果发送给父页面。   
![情况]({{ site.url }}/assets/iframe跨域参数传递方式/case.jpg)

## 跨域参数传递方式   

iframe跨域参数传递方式主要分为3种:   
   
1.iframe的location.hash   

2.通过window.name   

3.通过HTML5 API:PostMessage   

location.hash 方式的缺陷主要在于url长度有限制，且参数暴露在外部。   



## 使用PostMessage API来传递跨域参数
外层域名a.com页面代码   

```
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PostMessage</title>
<head>
<body>
<iframe id="f" src="http://a.com/inner.html" onload="sendMsg()"></iframe>
<div class="content"></div>
<script>
window.addEventListener('message',function(e){
	document.getElementsByClassName('content')[0].innerHTML=e.data;	
},false);

function sendMsg(){
	var _iframe=window.frames[0];
	_iframe.postMessage("PostMessage outer to inner","http://a.com/inner.html");
}
</script>
</body>
</html>
```   

  
内层域名b.com页面代码   

```
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PostMessage</title>
<head>
<body>
<script>
window.addEventListener('message',function(e){
  	if (e.origin !== "http://a.com")return;
	document.write(e.data);	
	e.source.postMessage("PostMessageinner to outer",e.origin);	
});
</script>
</body>
</html>
```   

   
![运行结果]({{ site.url }}/assets/iframe跨域参数传递方式/demo.jpg)




