<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]--> <title>iOS position fixed 在输入框获得焦点时定位失效</title> <meta name="description" content="问题现象在ios（实测IOS8仍然存在该问题）中，如果某一DOM节点的postion定位为fixed，并且该节点中的某个子节点会唤起虚拟键盘的时候，Position:fixed的定位会被打破，造成下图中得效果："> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://kylar.cn/jekyll/update/2015/03/09/IOS-position-fixed.html"> <link rel="alternate" type="application/rss+xml" title="Kylar" href="http://kylar.cn/feed.xml" /> <script src="/assets/js/prefixfree.js"></script> </head> <body> <aside id="sidebar"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/"> <img id="sidebar-avatar-img" alt="" src="/assets/img/avatar.jpg"/> </a> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="all">全部文章</li> <li class="sidebar-tag" data-filter="我的作品">我的作品</li> <li class="sidebar-tag" data-filter="我的笔记">我的笔记</li> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="我的笔记" href="/2015/11/23/Web%E7%BC%93%E5%AD%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"> Web缓存学习笔记 </a> <a class="toc-link" data-tags="我的笔记" href="/2015/05/02/%E4%BD%BF%E7%94%A8ES6+Babel+Broswerify%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91.html"> 使用ES6+Babel+Broswerify进行开发 </a> <a class="toc-link" data-tags="我的作品 我的笔记" href="/jekyll/update/2015/05/01/MinRequest-%E8%BD%BB%E9%87%8F%E5%8C%96jsonp%E8%B7%A8%E5%9F%9F%E5%AE%9E%E7%8E%B0.html"> MinRequest-轻量化jsonp跨域实现 </a> <a class="toc-link" data-tags="我的作品" href="/2015/04/30/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%B0%83%E8%AF%95%E9%9D%A2%E6%9D%BF-MinPanel%20.html"> 移动端调试面板-MinPanel </a> <a class="toc-link" data-tags="我的笔记" href="/jekyll/update/2015/04/29/this%E4%B8%8E%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%A8%A1%E5%BC%8F.html"> this与函数调用模式 </a> <a class="toc-link" data-tags="我的作品" href="/2015/04/28/mBaseCli-%E5%8E%9F%E5%AD%90%E5%8C%96%E6%A8%A1%E5%9D%97%E4%BE%9D%E8%B5%96%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html"> mBaseCli-原子化模块依赖解决方案 </a> <a class="toc-link" data-tags="我的笔记" href="/2015/04/15/%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html"> 模块开发中的设计模式 </a> <a class="toc-link" data-tags="我的笔记" href="/2015/04/10/WebApp%E5%8F%91%E5%B1%95%E8%B6%8B%E5%8A%BF%E7%9A%84%E4%B8%80%E4%BA%9B%E5%88%86%E6%9E%90%E5%92%8C%E7%9C%8B%E6%B3%95.html"> WebApp发展趋势的一些分析和看法 </a> <a class="toc-link" data-tags="我的笔记" href="/2015/04/09/BFC%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.html"> BFC概念与实际应用场景 </a> <a class="toc-link" data-tags="我的笔记" href="/2015/04/07/iframe%E8%B7%A8%E5%9F%9F%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E6%96%B9%E5%BC%8F.html"> iframe跨域参数传递方式 </a> <a class="toc-link" data-tags="我的作品" href="/2015/04/02/Ns.css%E8%A7%86%E8%A7%89%E6%A0%B7%E5%BC%8F%E5%BA%93.html"> Ns.css视觉样式库 </a> <a class="toc-link" data-tags="我的作品" href="/2015/03/27/%E7%AE%80%E5%8C%96%E6%B5%8F%E8%A7%88%E5%99%A8Url%E6%93%8D%E4%BD%9C--EasyUrl.html"> 简化浏览器Url操作--EasyUrl </a> <a class="toc-link" data-tags="我的笔记 我的作品" href="/2015/03/27/%E7%94%A8EMCAScript6%E6%9D%A5%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9D%97.html"> 用EMCAScript6来开发模块 </a> <a class="toc-link" data-tags="我的笔记" href="/jekyll/update/2015/03/09/IOS-position-fixed.html"> iOS position fixed 在输入框获得焦点时定位失效 </a> <a class="toc-link" data-tags="我的笔记" href="/2014/12/16/HTML5%E7%A6%BB%E7%BA%BF%E7%BC%93%E5%AD%98%E7%AC%94%E8%AE%B0.html"> HTML5离线缓存笔记 </a> <a class="toc-link" data-tags="我的笔记" href="/2014/11/09/AMD&CommonJS%E6%A8%A1%E5%9D%97%E6%A0%87%E5%87%86.html"> AMD&CommonJS模块标准 </a> <a class="toc-link" data-tags="我的笔记" href="/2014/09/09/NodeJS%E5%BC%82%E6%AD%A5%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6.html"> NodeJS异步流程控制 </a> <a class="toc-link" data-tags="我的笔记" href="/2014/07/17/%E5%89%8D%E7%AB%AF%E6%B8%B2%E6%9F%93%E6%A8%A1%E6%9D%BFjsTpl%E6%80%A7%E8%83%BD%E6%AF%94%E8%BE%83.html"> 前端渲染模板jsTpl性能比较 </a> <a class="toc-link" data-tags="我的作品" href="/2014/04/01/%E8%BF%90%E8%90%A5%E7%BB%84%E4%BB%B6%E5%BA%93.html"> 运营组件库 </a> <a class="toc-link" data-tags="我的笔记" href="/2014/03/17/flexbox%E5%B8%83%E5%B1%80%E7%9A%84%E7%89%88%E6%9C%AC%E5%8C%BA%E5%88%AB%E5%92%8C%E4%BD%BF%E7%94%A8.html"> flexbox布局的版本区别和使用 </a> <a class="toc-link" data-tags="我的作品" href="/2014/02/01/%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%AD%E9%97%B4%E5%88%86%E4%BA%AB%E9%A1%B5%E7%94%9F%E6%88%90%E6%9C%8D%E5%8A%A1.html"> 自动化中间分享页生成服务 </a> <a class="toc-link" data-tags="我的作品" href="/2014/01/02/Web-Compoents%E4%B8%AD%E6%96%87%E7%BD%91.html"> Web-Components中文网 </a> <a class="toc-link" data-tags="我的作品" href="/jekyll/update/2014/01/01/%E7%A7%BB%E5%8A%A8%E7%BB%84%E4%BB%B6%E6%96%87%E6%A1%A3%E7%B3%BB%E7%BB%9F.html"> 移动组件文档系统 </a> </nav> </div> </aside> <main id="main"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2015 March 09</span> <span class="post-meta-span tag">我的笔记</span> </div> <h1 class="post-title">iOS position fixed 在输入框获得焦点时定位失效</h1> <h2 id="section">问题现象</h2> <p>在ios（实测IOS8仍然存在该问题）中，如果某一DOM节点的postion定位为fixed，并且该节点中的某个子节点会唤起虚拟键盘的时候，Position:fixed的定位会被打破，造成下图中得效果：</p> <p><img src="http://kylar.cn/assets/IOS-position-fixed/ios8-1.png" alt="ios8-1" /> <img src="http://kylar.cn/assets/IOS-position-fixed/ios8-2.png" alt="ios8-2" /></p> <p>这一类的场景在社交功能类得App中可以说非常的常见， 通过现象可以推测在输入框获得焦点的时候，footer的位置被居中了，并且可以进行滚动。 这个BUG是IOS webkit的一个经典BUG，网上也可以找到较多的解决方案。简而言之，在调起虚拟键盘的时候，页面的流被打破了，可以通过手工来设定改变这个时候的定位来解决这个问题。</p> <p>以下是一种成本最低，且效果最佳的方案(不会引发额外的BUG)。</p> <h2 id="section-1">解决方案：</h2> <div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
	<span class="c">&lt;!-- head stuffs --&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;header&quot;</span><span class="nt">&gt;</span>A positon :fixed Header<span class="nt">&lt;input&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
	<span class="c">&lt;!-- main part --&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>A positon :fixed Footer<span class="nt">&lt;input&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></div> <div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;focus&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.header&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;fixfixed&#39;</span><span class="p">);</span>
 	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.footer&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;fixfixed&#39;</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;blur&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.header&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;fixfixed&#39;</span><span class="p">);</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.footer&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;fixfixed&#39;</span><span class="p">);</span>
    <span class="p">});</span></code></pre></div> <div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.header</span> <span class="p">{</span> 
    <span class="k">position</span><span class="o">:</span> <span class="k">fixed</span><span class="p">;</span> 
    <span class="k">height</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span> 
    <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span> 
    <span class="k">top</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span> 
    <span class="k">z-index</span><span class="o">:</span> <span class="m">1000</span><span class="p">;</span> 
<span class="p">}</span> 
<span class="nc">.footer</span> <span class="p">{</span> 
    <span class="k">position</span><span class="o">:</span> <span class="k">fixed</span><span class="p">;</span> 
    <span class="k">height</span><span class="o">:</span> <span class="m">30px</span><span class="p">;</span> 
    <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span> 
    <span class="k">bottom</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span> 
    <span class="k">z-index</span><span class="o">:</span> <span class="m">1000</span><span class="p">;</span> 
<span class="p">}</span> 

<span class="o">//</span><span class="nt">Hack</span>
<span class="nc">.fixfixed</span><span class="o">,</span> 
<span class="nc">.fixfixed</span><span class="p">{</span> 
    <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span> 
<span class="p">}</span></code></pre></div> <h2 id="bonus">Bonus</h2> <p>在实际的测试过程中，发现了一个更隐蔽的BUG，在IPHONE4环境下，点击Input获得输入框焦点的时候，会引发‘穿透’现象，即触发了positon:fixed元素下面一层的元素事件，如图所示：</p> <p><img src="http://kylar.cn/assets/IOS-position-fixed/ip4-1.png" alt="ip4-1" /></p> <p>在这里会触发点击评论的事件，尝试使用<code>event.stopPropagation()</code>去阻止事件冒泡并没有效果，根据之前对header &amp; footer 定位的方案，所以考虑通过改变Body的定位，使整个页面定位为absolute。</p> <p>代码如下：</p> <div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;focus&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.header&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;fixfixed&#39;</span><span class="p">);</span>
 	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.footer&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;fixfixed&#39;</span><span class="p">);</span>
	<span class="c1">//add body postion</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.body&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;fixfixed&#39;</span><span class="p">);</span>

    <span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;blur&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.header&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;fixfixed&#39;</span><span class="p">);</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.footer&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;fixfixed&#39;</span><span class="p">);</span>
	<span class="c1">//add body postion</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.body&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;fixfixed&#39;</span><span class="p">);</span>
    <span class="p">});</span></code></pre></div> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://kylar.cn/jekyll/update/2015/03/09/IOS-position-fixed.html&text=iOS position fixed 在输入框获得焦点时定位失效" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://kylar.cn/jekyll/update/2015/03/09/IOS-position-fixed.html&title=iOS position fixed 在输入框获得焦点时定位失效" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://kylar.cn/jekyll/update/2015/03/09/IOS-position-fixed.html&title=iOS position fixed 在输入框获得焦点时定位失效" target="_blank" class="post-share-icon weibo"></a> </div> </div> <div class="comment container"> <div id="disqus_thread"></div> <script type="text/javascript"> /* * * CONFIGURATION VARIABLES * * */ var disqus_shortname = 'devwayne'; /* * * DON'T EDIT BELOW THIS LINE * * */ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a> </noscript> </div> <div class="footer"> <div class="container"> <p class="footer-entry">Copyright © 2015 kylar.cn Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> </main> <button id="menu"> <span id="menu-icons"></span> </button> <script src="/assets/js/jquery-2.1.3.min.js"></script> <script src="/assets/js/jquery.pjax.js"></script> <script src="/assets/js/nprogress.js"></script> <script src="/assets/js/main.js"></script> </body> </html>
